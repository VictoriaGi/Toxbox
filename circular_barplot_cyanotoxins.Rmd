---
title: "R Notebook"
output: html_notebook
---



```{r}
medcon_circ <-  medcon_clean %>% 
  select(Country, Cyanotoxin) %>% 
  group_by(Cyanotoxin) %>% 
  summarize(N_records = n()) %>% 
  mutate(Percent = N_records/sum(N_records)*100) %>%
  mutate(Percent = round(Percent,1)) %>% 
  arrange(desc(N_records))
medcon_circ

# append number to category name
#medcon_circ$Cyanotoxin <- paste0(medcon_circ$Cyanotoxin, " - ", medcon_circ$Percent, "%")
#is.num <- sapply(medcon_circ, is.numeric)
#medcon_circ[is.num] <- lapply(medcon_circ[is.num], round, 1)

# set factor so it will plot in descending order
medcon_circ$Cyanotoxin <- factor(medcon_circ$Cyanotoxin, levels = rev(medcon_circ$Cyanotoxin))

medcon_circ_barplot <- ggplot(medcon_circ, aes(x= Cyanotoxin, y = Percent, fill = Cyanotoxin)) + geom_bar(width = 0.85, stat = "identity") + coord_polar(theta = "y") + xlab("") + ylab("") + ylim(c(0,30)) + geom_text(data = medcon_circ, hjust = 1, size = 6,colour = "white", family = "serif", aes(x = Cyanotoxin, y = 0, label = Cyanotoxin)) + 
  scale_fill_manual(values = c("Anatoxin-a" = "#7fc97f", 
                               "Saxitoxin" = "#beaed4",
                               "Cylindrospermopsin" = "#fdc086",
                               "Microcystin" = "#ffff99",
                               "Nodularin" = "#CC6666",
                               "Nothing" = "#990000")) +
  theme_minimal() + theme( legend.position = "none") 
 
medcon_circ_barplot_white <- medcon_circ_barplot + theme(axis.ticks = element_line(colour = "white"), 
    axis.text = element_text(size = , colour = "white"), 
    axis.text.x = element_text(size = 15, 
        colour = "white"), axis.text.y = element_text(size = 15, 
        colour = "white")) + theme(axis.line = element_line(colour = "white"), 
    axis.ticks = element_line(colour = "white"), 
    axis.title = element_text(colour = "white"), 
    plot.title = element_text(colour = "white")) + 
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "transparent",colour = NA),
        plot.background = element_rect(fill = "transparent",colour = NA),
        legend.background = element_rect(fill = NA)
        )
medcon_circ_barplot_white

  ggsave("circular_barplot.png", bg = "transparent", dpi = 300)
```

```{r}
medcon_clean_heatmap <- medcon_clean %>% 
  select(Species, Country, Cyanotoxin) %>%
  group_by(Country)
  
medcon_clean_heatmap2 <- melt(medcon_clean_heatmap, id.var = 'Species')

a <-ggplot(medcon_clean_heatmap, aes(x = Country, y = Cyanotoxin)) + geom_tile(aes(fill= Species), colour = "red") + 
  scale_fill_manual(values = rainbow(647))
a
```



```{r}
medcon_treemap <- medcon_clean %>% 
  select(Country, Cyanotoxin) %>% 
  group_by(Cyanotoxin) %>% 
  summarize(N = n())
medcon_tree <- medcon_treemap[-1, ]
medcon_tree

treemap(medcon_tree,
        index = "Cyanotoxin",
        vSize = "N",
        type = "index")
```

```{r}
library(dplyr)
library(treemap)

medcon_treemap_subgroups <- medcon_clean %>% 
  select(Cyanotoxin, Country) %>% 
  group_by(Cyanotoxin, Country) %>% 
  summarize(N = n())
medcon_treemap_subgroups

medcon_treemap_subgroup <- medcon_treemap_subgroups[-1, ]

treemap (medcon_treemap_subgroup, 
         index = c("Cyanotoxin", "Country"),
         vSize = "N",
         type = "index") + scale_fill_manual(values = c("Anatoxin" = "#7fc97f", 
                               "Saxitoxin" = "#beaed4",
                               "Cylindrospermopsin" = "#fdc086",
                               "Microcystin" = "#ffff99",
                               "Nodularin" = "#CC6666",
                               "Nothing" = "#990000"))
```


